# Nginx configuration for browser caching of static assets

# Settings for SVG files (moved before general static files to take precedence)
location ~* \.svg$ {
    add_header Content-Security-Policy "default-src 'self'";
    expires 30d;
    add_header Cache-Control "public, no-transform";
    add_header Vary Accept;
    access_log off;
    etag on;
    try_files $uri =404;
}

# Enable cache for all static files (removed svg from this block)
location ~* \.(jpg|jpeg|png|gif|ico|webp|avif|css|js|eot|ttf|woff|woff2|otf)$ {
    expires 30d;
    add_header Cache-Control "public, no-transform";
    add_header Vary Accept;
    access_log off;
    
    # Set ETag header for better cache validation
    etag on;
    
    # Try to serve static files from Nginx
    try_files $uri =404;
}

# Cache WordPress common files (minified JS/CSS, emoji JS)
location ~* ^.*\.(min\.(css|js)|wp-emoji-release\.min\.js)$ {
    expires 7d;
    add_header Cache-Control "public, no-transform";
}

# Don't cache PHP files or admin areas
location ~* \.php$ {
    expires epoch;
    add_header Cache-Control "no-store, no-cache, must-revalidate, max-age=0";
}

location ~ ^/(wp-admin|wp-login\.php) {
    expires epoch;
    add_header Cache-Control "no-store, no-cache, must-revalidate, max-age=0";
}